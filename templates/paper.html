{% extends "layout.html" %}

{% block title %}Research Paper: {{ paper.title }}{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('research_status', session_id=session_id) }}">Research Results</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Research Paper</li>
                </ol>
            </nav>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-7">
            <h2>Research Paper</h2>
            <p class="lead">Topic: {{ topic }}</p>
        </div>
        <div class="col-md-5 text-md-end">
            <div class="btn-group" role="group">
                <a href="{{ url_for('download_paper', session_id=session_id, paper_id=paper_id) }}" class="btn btn-primary">
                    <i class="bi bi-download"></i> Download as Text
                </a>
                <a href="{{ url_for('download_paper', session_id=session_id, paper_id=paper_id, format='latex') }}" class="btn btn-info">
                    <i class="bi bi-file-earmark-code"></i> Download LaTeX
                </a>
                <a href="{{ url_for('download_paper', session_id=session_id, paper_id=paper_id, format='arxiv') }}" class="btn btn-secondary">
                    <i class="bi bi-journal-code"></i> Download ArXiv Format
                </a>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="paper-container">
                        {{ paper_html|safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info">
                <h4>About This Paper</h4>
                <p>This paper was automatically generated by the AI Co-Scientist system based on the research findings. The content is structured according to academic standards with proper citations and methodology.</p>
                <p><strong>Word Count:</strong> {{ paper.word_count }}</p>
                <p><strong>Generated:</strong> {{ paper.created_at.strftime('%Y-%m-%d %H:%M') if paper.created_at else 'Unknown' }}</p>
            </div>
        </div>
    </div>
    
    {% if achievements %}
    <div class="row mt-3">
        <div class="col-12">
            <div class="alert alert-success">
                <h4><i class="bi bi-trophy"></i> Achievements Unlocked</h4>
                <p>{{ achievements }}</p>
                <p class="mt-2">
                    <a href="{{ url_for('achievements') }}" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-award"></i> View All Achievements
                    </a>
                </p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block styles %}
<style>
    .paper-container {
        font-family: 'Georgia', 'Times New Roman', Times, serif;
        line-height: 1.7;
        color: #212529;
        padding: 25px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .paper-container h1 {
        text-align: center;
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 25px;
        color: #000000;
    }
    
    .paper-container h2 {
        font-size: 20px;
        font-weight: 600;
        margin-top: 35px;
        margin-bottom: 20px;
        color: #000000;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 6px;
    }
    
    .paper-container .abstract {
        font-style: italic;
        margin-bottom: 35px;
        padding: 20px;
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        color: #212529;
    }
    
    .paper-container .authors {
        text-align: center;
        margin-bottom: 35px;
        font-size: 17px;
        color: #333333;
    }
    
    .paper-container .section {
        margin-bottom: 35px;
    }
    
    .paper-container p {
        margin-bottom: 15px;
        text-align: justify;
        color: #333333;
    }
    
    .paper-container .references {
        padding-left: 35px;
        border-top: 1px solid #dee2e6;
        padding-top: 20px;
        margin-top: 40px;
    }
    
    .paper-container .reference {
        margin-bottom: 12px;
        text-indent: -35px;
        padding-left: 35px;
        font-size: 15px;
        color: #333333;
    }
    
    .paper-container .footer {
        margin-top: 40px;
        text-align: center;
        font-size: 0.9em;
        color: #555555;
        border-top: 1px solid #dee2e6;
        padding-top: 15px;
    }
    
    .keywords {
        margin-bottom: 30px;
        font-size: 15px;
        color: #333333;
    }
    
    .key-point {
        background-color: #e9f5ff;
        padding: 10px 15px;
        border-left: 3px solid #0366d6;
        margin: 20px 0;
        border-radius: 0 4px 4px 0;
        color: #333333;
    }
    
    blockquote {
        border-left: 4px solid #ced4da;
        padding-left: 20px;
        margin-left: 0;
        color: #333333;
        font-style: italic;
    }
    
    code {
        font-family: Consolas, monospace;
        background-color: #f0f0f0;
        padding: 2px 4px;
        border-radius: 3px;
        font-size: 0.9em;
        color: #000000;
    }
    
    @media print {
        .breadcrumb, .alert, .btn, nav, footer {
            display: none !important;
        }
        
        .paper-container {
            font-size: 12pt;
            box-shadow: none;
            border: none;
        }
        
        .paper-container h1 {
            font-size: 16pt;
        }
        
        .paper-container h2 {
            font-size: 14pt;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add print button
        const paperContainer = document.querySelector('.paper-container');
        const printBtn = document.createElement('button');
        printBtn.className = 'btn btn-secondary mt-3';
        printBtn.innerHTML = '<i class="bi bi-printer"></i> Print Paper';
        printBtn.addEventListener('click', function() {
            window.print();
        });
        
        paperContainer.parentNode.insertBefore(printBtn, paperContainer.nextSibling);
    });
</script>
{% endblock %}